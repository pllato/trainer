<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Тренировка грамматики</title>
</head>
<body>
  <div>
    <h1>Тренировка грамматики</h1>
    <div>
      <label for="user-name">Ваше имя</label>
      <input type="text" id="user-name">
    </div>
    <div>
      <label for="level-select">Выберите уровень</label>
      <select id="level-select">
        <option value="beginner-part-one">Beginner Part One</option>
        <option value="beginner-part-two">Beginner Part Two</option>
        <option value="elementary">Elementary</option>
        <option value="pre-intermediate">Pre-Intermediate</option>
        <option value="intermediate">Intermediate</option>
        <option value="upper-intermediate">Upper-Intermediate</option>
      </select>
    </div>
    <div>
      <label for="lesson-select">Выберите урок</label>
      <select id="lesson-select">
        <option value="lesson-1">Урок 1</option>
        <option value="lesson-3">Урок 3</option>
      </select>
    </div>
    <button onclick="startPractice()">Начать практику</button>
  </div>

  <div id="practice-section" style="display: none;">
    <h2>Практика грамматики</h2>
    <a href="#" onclick="goHome()">Назад (домой)</a>
    <p>Привет, <span id="greeting-name"></span>!</p>
    <p>Уровень: <span id="practice-level"></span>, <span id="practice-lesson"></span></p>
    <button onclick="startPractice()">Начать практику</button>
    <button onclick="resumeListening()">Возобновить прослушивание</button>
    <div>
      <h3>Прогресс:</h3>
      <div id="progress-content"></div>
    </div>
    <div>
      <h3>Лог:</h3>
      <div id="log-content"></div>
    </div>
  </div>

  <div id="exercise-section" style="display: none;">
    <div id="exercise-content"></div>
    <input type="text" id="user-input" placeholder="Введите ответ">
    <button onclick="checkAnswer()">Проверить</button>
    <div id="feedback"></div>
  </div>

  <div id="complete-section" style="display: none;">
    <h2>Урок завершён!</h2>
    <button onclick="sendResults()">Отправить результаты учителю</button>
    <button onclick="restartPractice()">Начать заново тренировку</button>
  </div>

  <script>
    let currentLesson = null;
    let currentExercise = 0;
    let progress = [];
    let log = [];

    // Lesson 3 Data
    const lesson3 = {
      sentences: [
        { text: "I am a _______.", requires: "singular" },
        { text: "You are a _______.", requires: "singular" },
        { text: "He is a _______.", requires: "singular" },
        { text: "She is a _______.", requires: "singular" },
        { text: "We are _______s.", requires: "plural" },
        { text: "They are _______s.", requires: "plural" }
      ],
      professions: [
        "teacher", "doctor", "engineer", "artist", "chef",
        "pilot", "lawyer", "nurse", "programmer", "writer"
      ],
      examples: {
        singular: "I am a teacher. You are a doctor. He is an engineer. She is an artist.",
        plural: "We are teachers. They are doctors."
      },
      validate: function(input, requires) {
        const singularProfessions = this.professions;
        const pluralProfessions = this.professions.map(p => p + "s");
        const isSingular = singularProfessions.includes(input.toLowerCase());
        const isPlural = pluralProfessions.includes(input.toLowerCase());

        if (requires === "singular") {
          if (!isSingular) {
            return {
              correct: false,
              message: `Пожалуйста, введите профессию в единственном числе, например, 'teacher' или 'doctor'. Вы ввели: ${input}`
            };
          }
          return { correct: true, message: "Правильно!" };
        } else {
          if (!isPlural) {
            return {
              correct: false,
              message: `Пожалуйста, введите профессию во множественном числе, например, 'teachers' или 'doctors'. Вы ввели: ${input}`
            };
          }
          return { correct: true, message: "Правильно!" };
        }
      }
    };

    function startPractice() {
      const name = document.getElementById("user-name").value || "User";
      const level = document.getElementById("level-select").value;
      const lesson = document.getElementById("lesson-select").value;

      document.querySelectorAll("div").forEach(div => div.style.display = "none");
      document.getElementById("practice-section").style.display = "block";
      document.getElementById("greeting-name").textContent = name;
      document.getElementById("practice-level").textContent = level.replace(/-/g, " ");
      document.getElementById("practice-lesson").textContent = lesson.replace(/-/g, " ");

      if (lesson === "lesson-3" && level === "beginner-part-one") {
        currentLesson = lesson3;
        startExercise();
      } else {
        document.getElementById("progress-content").textContent = "Урок не реализован.";
      }
    }

    function startExercise() {
      document.getElementById("practice-section").style.display = "none";
      document.getElementById("exercise-section").style.display = "block";
      currentExercise = 0;
      progress = [];
      showExercise();
    }

    function showExercise() {
      if (currentExercise >= currentLesson.sentences.length) {
        completeLesson();
        return;
      }
      const sentence = currentLesson.sentences[currentExercise];
      document.getElementById("exercise-content").textContent = sentence.text;
      document.getElementById("user-input").value = "";
      document.getElementById("feedback").textContent = "";
    }

    function checkAnswer() {
      const input = document.getElementById("user-input").value.trim();
      const sentence = currentLesson.sentences[currentExercise];
      const result = currentLesson.validate(input, sentence.requires);

      document.getElementById("feedback").textContent = result.message;
      progress.push({ sentence: sentence.text, input, correct: result.correct });
      log.push(`Упражнение ${currentExercise + 1}: ${sentence.text} Ввод: ${input} - ${result.message}`);
      updateProgress();
      updateLog();

      if (result.correct) {
        currentExercise++;
        showExercise();
      }
    }

    function updateProgress() {
      const progressContent = progress.map(p => 
        `${p.sentence.replace("_______", p.input)} - ${p.correct ? "Правильно" : "Неправильно"}`
      ).join("; ");
      document.getElementById("progress-content").textContent = progressContent;
    }

    function updateLog() {
      document.getElementById("log-content").textContent = log.join("; ");
    }

    function completeLesson() {
      document.getElementById("exercise-section").style.display = "none";
      document.getElementById("complete-section").style.display = "block";
    }

    function sendResults() {
      alert("Результаты отправлены учителю (заглушка).");
    }

    function restartPractice() {
      document.getElementById("complete-section").style.display = "none";
      document.getElementById("practice-section").style.display = "block";
      currentExercise = 0;
      progress = [];
      log = [];
      updateProgress();
      updateLog();
    }

    function goHome() {
      document.querySelectorAll("div").forEach(div => div.style.display = "none");
      document.querySelector("div").style.display = "block";
    }

    function resumeListening() {
      alert("Прослушивание возобновлено (заглушка).");
    }
  </script>
</body>
</html>
