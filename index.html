<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELC English Speaking Trainer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        select {
            padding: 10px;
            font-size: 16px;
            margin: 10px;
            width: 300px;
        }
        #log {
            text-align: left;
            margin-top: 20px;
            padding: 10px;
            background: #e8e8e8;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
        }
        .status {
            font-size: 18px;
            margin: 10px 0;
        }
        .examples {
            margin: 20px 0;
            text-align: left;
        }
        #currentStructures {
            font-size: 16px;
            margin: 15px 0;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ELC English Speaking Trainer</h1>
        <select id="tenseSelect">
            <option value="present">Present Simple</option>
            <!-- Add more tenses later -->
        </select>
        <select id="levelSelect">
            <option value="1">Level 1: Beginner (Daily Routines, Likes and Dislikes, Introductions and Greetings)</option>
            <option value="2">Level 2: Elementary (Daily Routines, Likes and Dislikes, Facts)</option>
            <option value="3">Level 3: Pre-Intermediate (Work and Study, Feelings and Opinions)</option>
            <option value="4">Level 4: Intermediate (Work and Study, Social Interactions)</option>
            <option value="5">Level 5: Upper-Intermediate (Social Interactions, Schedules and Events)</option>
        </select>
        <div class="examples">
            <h3>Examples of words to use:</h3>
            <p id="exampleVerbs">Select a level to see example words.</p>
        </div>
        <div id="currentStructures">
            <h3>Structures to practice:</h3>
            <ul id="structureList"></ul>
        </div>
        <button id="startButton">Start Practice</button>
        <div class="status" id="status">Correct: 0/10</div>
        <div class="status" id="listening">Press start to begin...</div>
        <div id="log">
            <h3>Practice Log:</h3>
            <div id="logEntries"></div>
        </div>
    </div>

    <script>
        const tenseSelect = document.getElementById('tenseSelect');
        const levelSelect = document.getElementById('levelSelect');
        const startButton = document.getElementById('startButton');
        const status = document.getElementById('status');
        const listening = document.getElementById('listening');
        const logEntries = document.getElementById('logEntries');
        const structureList = document.getElementById('structureList');
        const exampleVerbs = document.getElementById('exampleVerbs');

        let correctCount = 0;
        let recognition = null;
        let isListening = false;
        let saidSentences = new Set();
        let currentStructures = [];

        // Define structures for each level/theme
        const levels = {
            '1': [
                // Daily Routines
                'I _______ . (work, play, eat)',
                'You _______ . (work, play, eat)',
                'He _______s . (work, play, eat)',
                'She _______s . (work, play, eat)',
                'Mariya _______s . (work, play, eat)',
                'It _______s . (run, jump, eat)',
                'We _______ . (work, play, eat)',
                'They _______ . (work, play, eat)',
                // Likes and Dislikes
                'I _______ . (like, love, want)',
                'You _______ . (like, love, want)',
                'He _______s . (like, love, want)',
                'She _______s . (like, love, want)',
                'Mariya _______s . (like, love, want)',
                'It _______s . (like, love, want)',
                'We _______ . (like, love, want)',
                'They _______ . (like, love, want)',
                // Daily Routines (Negative)
                'I don’t _______ . (work, play, eat)',
                'You don’t _______ . (work, play, eat)',
                'He doesn’t _______ . (work, play, eat)',
                'She doesn’t _______ . (work, play, eat)',
                'Mariya doesn’t _______ . (work, play, eat)',
                'It doesn’t _______ . (run, jump, eat)',
                'We don’t _______ . (work, play, eat)',
                'They don’t _______ . (work, play, eat)',
                // Likes and Dislikes (Questions)
                'Do I _______ ? (like, love, want)',
                'Do you _______ ? (like, love, want)',
                'Does he _______ ? (like, love, want)',
                'Does she _______ ? (like, love, want)',
                'Does Mariya _______ ? (like, love, want)',
                'Does it _______ ? (like, love, want)',
                'Do we _______ ? (like, love, want)',
                'Do they _______ ? (like, love, want)',
                // Introductions and Greetings (New)
                'I am ______ . (Asel, Arman, Madina)',
                'You are ______ . (Asel, Arman, Madina)',
                'He is ______ . (Asel, Arman, Maksat)',
                'She is ______ . (Asel, Madina, Mariya)',
                'It is ______ . (a dog, a cat, a bird)',
                'We are ______ . (Asel and Arman, friends, students)',
                'They are ______ . (Asel and Maksat, teachers, colleagues)',
                'What is your name ?',
                'What is his name ?',
                'What is her name ?',
                'My name is ______ . (Asel, Arman, Maksat)',
                'His name is ______ . (Asel, Arman, Maksat)',
                'Her name is ______ . (Asel, Madina, Mariya)',
                'This is ______ . (Asel, Arman, Maksat)'
            ],
            '2': [
                'I always _______ . (work, play, eat)',
                'You often _______ . (work, play, eat)',
                'He never _______s . (work, play, eat)',
                'She sometimes _______s . (work, play, eat)',
                'Mariya always _______s . (work, play, eat)',
                'What do I _______ ? (like, love, want)',
                'What do you _______ ? (like, love, want)',
                'What does he _______ ? (like, love, want)',
                'What does she _______ ? (like, love, want)',
                'What does Mariya _______ ? (like, love, want)',
                'Yes, I _______ . (like, love, want)',
                'Yes, he _______s . (like, love, want)',
                'Yes, she _______s . (like, love, want)',
                'Yes, Mariya _______s . (like, love, want)',
                'No, I don’t _______ . (like, love, want)',
                'No, he doesn’t _______ . (like, love, want)',
                'No, she doesn’t _______ . (like, love, want)',
                'No, Mariya doesn’t _______ . (like, love, want)',
                'The sun _______s . (rise, set, shine)',
                'Water _______s . (boil, freeze, flow)'
            ],
            '3': [
                'I _______ English . (study, learn, teach)',
                'He _______s books . (read, write, buy)',
                'She _______s lessons . (prepare, give, attend)',
                'Mariya _______s projects . (manage, finish, start)',
                'I _______ at the office . (work, meet, stay)',
                'He _______s in the morning . (study, work, exercise)',
                'She _______s with her team . (collaborate, talk, plan)',
                'Mariya _______s on weekends . (work, study, relax)',
                'I feel _______ . (happy, tired, excited)',
                'He feels _______ . (happy, tired, excited)',
                'She feels _______ . (happy, tired, excited)',
                'Mariya feels _______ . (happy, tired, excited)',
                'Why do you feel _______ ? (happy, tired, excited)',
                'Why does he feel _______ ? (happy, tired, excited)',
                'Why does she feel _______ ? (happy, tired, excited)',
                'Why does Mariya feel _______ ? (happy, tired, excited)'
            ],
            '4': [
                'I like to _______ hard . (work, study, try)',
                'He _______s to learn quickly . (want, need, try)',
                'She _______s to teach well . (like, try, want)',
                'Mariya _______s to manage carefully . (like, try, want)',
                'Do you like to _______ hard ? (work, study, try)',
                'Does he _______ to learn quickly ? (want, need, try)',
                'Does she _______ to teach well ? (like, try, want)',
                'Does Mariya _______ to manage carefully ? (like, try, want)',
                'I _______ friends every weekend . (meet, call, visit)',
                'He _______s people at the park . (meet, help, greet)',
                'She _______s colleagues after work . (meet, call, join)',
                'Mariya _______s family on Sundays . (visit, call, help)',
                'Where do you _______ friends ? (meet, call, visit)',
                'Where does he _______ people ? (meet, help, greet)',
                'Where does she _______ colleagues ? (meet, call, join)',
                'Where does Mariya _______ family ? (visit, call, help)'
            ],
            '5': [
                'I like to _______ friends at a café every Friday . (meet, call, visit)',
                'He _______s to help people at the community center weekly . (like, try, want)',
                'She _______s to join colleagues for dinner after work often . (like, try, want)',
                'Mariya _______s to visit family in the countryside every month . (like, try, want)',
                'Why do you like to _______ friends at a café ? (meet, call, visit)',
                'Why does he _______ to help people at the community center ? (like, try, want)',
                'Why does she _______ to join colleagues for dinner after work ? (like, try, want)',
                'Why does Mariya _______ to visit family in the countryside ? (like, try, want)',
                'The train _______ at 8 AM . (leave, arrive, stop)',
                'The class _______ at 9 AM . (start, end, begin)',
                'When does the train _______ ? (leave, arrive, stop)',
                'When does the class _______ ? (start, end, begin)'
            ]
        };

        // Update the displayed structures and examples
        function updateStructures() {
            const level = levelSelect.value;
            currentStructures = levels[level];

            // Update the structure list
            structureList.innerHTML = '';
            currentStructures.forEach(structure => {
                const li = document.createElement('li');
                li.textContent = structure;
                structureList.appendChild(li);
            });

            // Update example verbs (combine all verbs from the current level)
            const words = new Set();
            currentStructures.forEach(structure => {
                const match = structure.match(/\(([^)]+)\)/);
                if (match) {
                    const wordList = match[1].split(', ');
                    wordList.forEach(word => words.add(word));
                }
            });
            exampleVerbs.textContent = Array.from(words).join(', ') || 'Select a level to see example words.';
        }

        // Initialize speech recognition
        function initSpeechRecognition() {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onresult = (event) => {
                const spokenSentence = event.results[0][0].transcript.trim().toLowerCase();
                listening.textContent = 'Processing: ' + spokenSentence;
                checkSentence(spokenSentence);
            };

            recognition.onend = () => {
                if (isListening && correctCount < 10) {
                    recognition.start();
                    listening.textContent = 'Listening...';
                } else {
                    isListening = false;
                    listening.textContent = 'Stopped. Press start to begin...';
                    startButton.textContent = 'Start Practice';
                }
            };

            recognition.onerror = (event) => {
                listening.textContent = 'Error occurred: ' + event.error;
                isListening = false;
                startButton.textContent = 'Start Practice';
            };
        }

        // Check if the spoken sentence matches any structure in the current theme
        function checkSentence(spokenSentence) {
            const tense = tenseSelect.value;
            let isCorrect = false;
            let logMessage = '';

            if (tense === 'present') {
                isCorrect = currentStructures.some(structure => checkPresentSimpleSentence(spokenSentence, structure));
            }

            if (saidSentences.has(spokenSentence)) {
                logMessage = `Repeat: "${spokenSentence}"`;
            } else if (isCorrect) {
                correctCount++;
                saidSentences.add(spokenSentence);
                logMessage = `Correct: "${spokenSentence}"`;
                status.textContent = `Correct: ${correctCount}/10`;
            } else {
                logMessage = `Incorrect: "${spokenSentence}" (wrong form or structure)`;
            }

            // Add to log
            const logEntry = document.createElement('p');
            logEntry.textContent = logMessage;
            logEntries.prepend(logEntry);

            // Stop if 10 correct sentences are reached
            if (correctCount >= 10) {
                isListening = false;
                recognition.stop();
                listening.textContent = 'Congratulations! 10 correct sentences achieved!';
                startButton.textContent = 'Restart Practice';
            }
        }

        // Check if the spoken sentence matches the Present Simple structure
        function checkPresentSimpleSentence(spokenSentence, structure) {
            // Helper to check if a word is a valid base verb, adjective, or name
            function isValidBaseVerb(verb) {
                const pastTenseIndicators = ['ed', 'was', 'were', 'went', 'did'];
                if (!/^[a-z]+$/.test(verb)) return false;
                return !pastTenseIndicators.some(indicator => verb === indicator || verb.endsWith(indicator));
            }

            function isValidFeeling(word) {
                const feelings = ['happy', 'tired', 'excited', 'sad', 'angry'];
                return feelings.includes(word);
            }

            function isValidName(word) {
                const names = ['asel', 'arman', 'madina', 'maksat', 'mariya', 'a dog', 'a cat', 'a bird', 'asel and arman', 'asel and maksat', 'friends', 'students', 'teachers', 'colleagues'];
                return names.includes(word);
            }

            // Split the spoken sentence into words
            const spokenWords = spokenSentence.split(/\s+/);

            // Extract the structure without the example verbs
            const structureWithoutExamples = structure.split(' (')[0];
            const structureWords = structureWithoutExamples.toLowerCase().split(/\s+/);

            // Extract the expected position of the verb (where _______ or _______s is)
            let verbPosition = structureWords.indexOf('_______s');
            let isVerbS = verbPosition !== -1;
            if (verbPosition === -1) {
                verbPosition = structureWords.indexOf('_______');
                if (verbPosition === -1) return false;
            }

            // Adjust structure words to exclude punctuation and verb slot for length comparison
            const structureWordsWithoutPunctuation = structureWords.filter(word => word !== '.' && word !== '?' && word !== '_______s' && word !== '_______');
            let expectedLength = structureWordsWithoutPunctuation.length + 1; // +1 for the verb

            // Special case for questions like "What is your name ?" which have no slot
            if (structure === 'what is your name ?' || structure === 'what is his name ?' || structure === 'what is her name ?') {
                const expectedSentence = structureWords.join(' ').replace(' ?', '');
                return spokenSentence === expectedSentence;
            }

            // Check if the spoken sentence has at least the expected number of words
            if (spokenWords.length < expectedLength - 1) return false;

            // Extract the spoken word at the correct position
            let spokenVerbPosition = verbPosition;
            const spokenWord = spokenWords[spokenVerbPosition];
            if (!spokenWord) return false;

            // Verify the fixed parts of the sentence match
            let structureMatches = true;
            for (let i = 0; i < structureWords.length; i++) {
                if (i === verbPosition) continue; // Skip the verb slot
                if (structureWords[i] === '.' || structureWords[i] === '?') continue; // Skip punctuation

                let expectedWord = structureWords[i];
                let spokenWord = spokenWords[i] || '';

                // Handle special characters (e.g., "don’t" vs "don't")
                expectedWord = expectedWord.replace(/[^a-z]/g, '');
                spokenWord = spokenWord.replace(/[^a-z]/g, '');

                if (expectedWord && expectedWord !== spokenWord) {
                    structureMatches = false;
                    break;
                }
            }

            if (!structureMatches) return false;

            // Validate the word form based on the structure
            const baseVerbStructures = [
                'i _______ . (work, play, eat)',
                'you _______ . (work, play, eat)',
                'we _______ . (work, play, eat)',
                'they _______ . (work, play, eat)',
                'i _______ . (like, love, want)',
                'you _______ . (like, love, want)',
                'we _______ . (like, love, want)',
                'they _______ . (like, love, want)',
                'i don’t _______ . (work, play, eat)',
                'he doesn’t _______ . (work, play, eat)',
                'she doesn’t _______ . (work, play, eat)',
                'mariya doesn’t _______ . (work, play, eat)',
                'it doesn’t _______ . (run, jump, eat)',
                'we don’t _______ . (work, play, eat)',
                'you don’t _______ . (work, play, eat)',
                'they don’t _______ . (work, play, eat)',
                'do i _______ ? (like, love, want)',
                'does he _______ ? (like, love, want)',
                'does she _______ ? (like, love, want)',
                'does mariya _______ ? (like, love, want)',
                'does it _______ ? (like, love, want)',
                'do we _______ ? (like, love, want)',
                'do they _______ ? (like, love, want)',
                'i always _______ . (work, play, eat)',
                'you often _______ . (work, play, eat)',
                'what do i _______ ? (like, love, want)',
                'what do you _______ ? (like, love, want)',
                'what does he _______ ? (like, love, want)',
                'what does she _______ ? (like, love, want)',
                'what does mariya _______ ? (like, love, want)',
                'yes, i _______ . (like, love, want)',
                'no, i don’t _______ . (like, love, want)',
                'no, he doesn’t _______ . (like, love, want)',
                'no, she doesn’t _______ . (like, love, want)',
                'no, mariya doesn’t _______ . (like, love, want)',
                'i _______ english . (study, learn, teach)',
                'he _______s books . (read, write, buy)',
                'she _______s lessons . (prepare, give, attend)',
                'mariya _______s projects . (manage, finish, start)',
                'i _______ at the office . (work, meet, stay)',
                'he _______s in the morning . (study, work, exercise)',
                'she _______s with her team . (collaborate, talk, plan)',
                'mariya _______s on weekends . (work, study, relax)',
                'i like to _______ hard . (work, study, try)',
                'he _______s to learn quickly . (want, need, try)',
                'she _______s to teach well . (like, try, want)',
                'mariya _______s to manage carefully . (like, try, want)',
                'do you like to _______ hard ? (work, study, try)',
                'does he _______ to learn quickly ? (want, need, try)',
                'does she _______ to teach well ? (like, try, want)',
                'does mariya _______ to manage carefully ? (like, try, want)',
                'i _______ friends every weekend . (meet, call, visit)',
                'he _______s people at the park . (meet, help, greet)',
                'she _______s colleagues after work . (meet, call, join)',
                'mariya _______s family on sundays . (visit, call, help)',
                'where do you _______ friends ? (meet, call, visit)',
                'where does he _______ people ? (meet, help, greet)',
                'where does she _______ colleagues ? (meet, call, join)',
                'where does mariya _______ family ? (visit, call, help)',
                'i like to _______ friends at a café every friday . (meet, call, visit)',
                'he _______s to help people at the community center weekly . (like, try, want)',
                'she _______s to join colleagues for dinner after work often . (like, try, want)',
                'mariya _______s to visit family in the countryside every month . (like, try, want)',
                'why do you like to _______ friends at a café ? (meet, call, visit)',
                'why does he _______ to help people at the community center ? (like, try, want)',
                'why does she _______ to join colleagues for dinner after work ? (like, try, want)',
                'why does mariya _______ to visit family in the countryside ? (like, try, want)',
                'the train _______ at 8 am . (leave, arrive, stop)',
                'the class _______ at 9 am . (start, end, begin)',
                'when does the train _______ ? (leave, arrive, stop)',
                'when does the class _______ ? (start, end, begin)'
            ];

            const verbSStructures = [
                'he _______s . (work, play, eat)',
                'she _______s . (work, play, eat)',
                'mariya _______s . (work, play, eat)',
                'it _______s . (run, jump, eat)',
                'he _______s . (like, love, want)',
                'she _______s . (like, love, want)',
                'mariya _______s . (like, love, want)',
                'it _______s . (like, love, want)',
                'he never _______s . (work, play, eat)',
                'she sometimes _______s . (work, play, eat)',
                'mariya always _______s . (work, play, eat)',
                'yes, he _______s . (like, love, want)',
                'yes, she _______s . (like, love, want)',
                'yes, mariya _______s . (like, love, want)',
                'the sun _______s . (rise, set, shine)',
                'water _______s . (boil, freeze, flow)',
                'he _______s books . (read, write, buy)',
                'she _______s lessons . (prepare, give, attend)',
                'mariya _______s projects . (manage, finish, start)',
                'he _______s in the morning . (study, work, exercise)',
                'she _______s with her team . (collaborate, talk, plan)',
                'mariya _______s on weekends . (work, study, relax)',
                'he _______s to learn quickly . (want, need, try)',
                'she _______s to teach well . (like, try, want)',
                'mariya _______s to manage carefully . (like, try, want)',
                'he _______s people at the park . (meet, help, greet)',
                'she _______s colleagues after work . (meet, call, join)',
                'mariya _______s family on sundays . (visit, call, help)',
                'he _______s to help people at the community center weekly . (like, try, want)',
                'she _______s to join colleagues for dinner after work often . (like, try, want)',
                'mariya _______s to visit family in the countryside every month . (like, try, want)'
            ];

            const yesBaseVerbStructures = [
                'yes, i _______ . (like, love, want)',
                'yes, we _______ . (like, love, want)',
                'yes, you _______ . (like, love, want)',
                'yes, they _______ . (like, love, want)'
            ];

            const feelStructures = [
                'i feel _______ . (happy, tired, excited)',
                'he feels _______ . (happy, tired, excited)',
                'she feels _______ . (happy, tired, excited)',
                'mariya feels _______ . (happy, tired, excited)',
                'why do you feel _______ ? (happy, tired, excited)',
                'why does he feel _______ ? (happy, tired, excited)',
                'why does she feel _______ ? (happy, tired, excited)',
                'why does mariya feel _______ ? (happy, tired, excited)'
            ];

            const beStructures = [
                'i am ______ . (asel, arman, madina)',
                'you are ______ . (asel, arman, madina)',
                'he is ______ . (asel, arman, maksat)',
                'she is ______ . (asel, madina, mariya)',
                'it is ______ . (a dog, a cat, a bird)',
                'we are ______ . (asel and arman, friends, students)',
                'they are ______ . (asel and maksat, teachers, colleagues)',
                'my name is ______ . (asel, arman, maksat)',
                'his name is ______ . (asel, arman, maksat)',
                'her name is ______ . (asel, madina, mariya)',
                'this is ______ . (asel, arman, maksat)'
            ];

            structure = structure.toLowerCase();
            if (baseVerbStructures.includes(structure)) {
                return isValidBaseVerb(spokenWord) && !spokenWord.endsWith('s') && !spokenWord.endsWith('es');
            } else if (verbSStructures.includes(structure)) {
                return isValidBaseVerb(spokenWord.replace(/(s|es)$/, '')) && (spokenWord.endsWith('s') || spokenWord.endsWith('es'));
            } else if (yesBaseVerbStructures.includes(structure)) {
                return isValidBaseVerb(spokenWord) && !spokenWord.endsWith('s') && !spokenWord.endsWith('es');
            } else if (feelStructures.includes(structure)) {
                return isValidFeeling(spokenWord);
            } else if (beStructures.includes(structure)) {
                return isValidName(spokenWord);
            }

            return false;
        }

        // Event listeners
        tenseSelect.addEventListener('change', () => {
            correctCount = 0;
            status.textContent = 'Correct: 0/10';
            saidSentences.clear();
            logEntries.innerHTML = '';
            updateStructures();
            if (isListening) {
                recognition.stop();
                isListening = false;
                startButton.textContent = 'Start Practice';
                listening.textContent = 'Press start to begin...';
            }
        });

        levelSelect.addEventListener('change', () => {
            updateStructures();
            correctCount = 0;
            status.textContent = 'Correct: 0/10';
            saidSentences.clear();
            logEntries.innerHTML = '';
            if (isListening) {
                recognition.stop();
                isListening = false;
                startButton.textContent = 'Start Practice';
                listening.textContent = 'Press start to begin...';
            }
        });

        startButton.addEventListener('click', () => {
            if (!isListening) {
                if (!recognition) initSpeechRecognition();
                isListening = true;
                recognition.start();
                startButton.textContent = 'Stop Practice';
                listening.textContent = 'Listening...';
            } else {
                isListening = false;
                recognition.stop();
                startButton.textContent = 'Start Practice';
                listening.textContent = 'Stopped. Press start to begin...';
            }
        });

        // Initialize structures
        updateStructures();
    </script>
</body>
</html>
